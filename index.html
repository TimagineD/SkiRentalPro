<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Rental Manager</title>
    <!-- Tailwind for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase JS SDK (Compatible with Supabase Auth/Firestore layers) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- CONFIGURATION ---
        // REPLACE THESE WITH YOUR SUPABASE/FIREBASE DETAILS
        const firebaseConfig = {
            apiKey: "AIzaSyD_D8K-d74C6IN7ZN7VE1KzKAHWCgc1fc",
            authDomain: "skirentalpro.firebaseapp.com",
            projectId: "skirentalpro",
            storageBucket: "skirentalpro.firebasestorage.app",
            messagingSenderId: "701788497633",
            appId: "1:701788497633:web:761d6d04f2496344ebb9a0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "1:701788497633:web:761d6d04f2496344ebb9a0"; // Unique ID for your data

        const GEAR_TYPES = [
            { id: 'ski', label: 'Ð¡ÐšÐ˜Ð˜', emoji: 'ðŸŽ¿' },
            { id: 'board', label: 'Ð‘ÐžÐ Ð”', emoji: 'ðŸ‚' },
            { id: 'sleigh', label: 'Ð¡ÐÐÐšÐ', emoji: 'ðŸ›·' },
            { id: 'poles', label: 'Ð¡Ð¢ÐÐŸÐžÐ’Ð˜', emoji: 'ðŸ¦¯' },
            { id: 'boots', label: 'ÐšÐžÐÐ”.', emoji: 'â›¸ï¸' },
            { id: 'helmet', label: 'ÐšÐÐ¦Ð˜Ð“Ð', emoji: 'ðŸª–' },
            { id: 'goggles', label: 'ÐÐÐžÐ§ÐÐ Ð˜', emoji: 'ðŸ¥½' },
            { id: 'gloves', label: 'Ð ÐÐšÐ’Ð˜Ð¦Ð˜', emoji: 'ðŸ§¤' }
        ];

        const STATUSES = { AVAILABLE: 'Available', RENTED: 'Rented', ARCHIVED: 'Archived' };

        // Transliteration Helper
        const transliterate = (text) => {
            if (!text) return "";
            const map = {'Ð°':'a','Ð±':'b','Ð²':'v','Ð³':'g','Ð´':'d','Ðµ':'e','Ð¶':'zh','Ð·':'z','Ð¸':'i','Ñ˜':'j','Ðº':'k','Ð»':'l','Ñ™':'lj','Ð¼':'m','Ð½':'n','Ñš':'nj','Ð¾':'o','Ð¿':'p','Ñ€':'r','Ñ':'s','Ñ‚':'t','Ñœ':'kj','Ñƒ':'u','Ñ„':'f','Ñ…':'h','Ñ†':'c','Ñ‡':'ch','ÑŸ':'dz','Ñˆ':'sh'};
            return text.toLowerCase().split('').map(char => map[char] || char).join('');
        };

        const matchesSearch = (text, term) => {
            if (!term) return true;
            const t = text.toLowerCase();
            const s = term.toLowerCase();
            return t.includes(s) || transliterate(t).includes(transliterate(s));
        };

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('GEAR');
            const [gear, setGear] = useState([]);
            const [clients, setClients] = useState([]);
            const [history, setHistory] = useState([]);
            const [search, setSearch] = useState('');
            const [modal, setModal] = useState(null);
            const [selected, setSelected] = useState(null);

            // Paths
            const gearRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('gear');
            const clientsRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('clients');
            const historyRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('history');

            useEffect(() => {
                auth.signInAnonymously().catch(console.error);
                auth.onAuthStateChanged(u => {
                    setUser(u);
                    if (u) {
                        gearRef.onSnapshot(s => setGear(s.docs.map(d => ({id: d.id, ...d.data()}))));
                        clientsRef.onSnapshot(s => setClients(s.docs.map(d => ({id: d.id, ...d.data()}))));
                        historyRef.orderBy('timestamp', 'desc').limit(50).onSnapshot(s => setHistory(s.docs.map(d => ({id: d.id, ...d.data()}))));
                    }
                });
            }, []);

            const handleRent = async (gearItem, client) => {
                const dateStr = new Date().toLocaleString('mk-MK');
                await gearRef.doc(gearItem.id).update({
                    status: STATUSES.RENTED,
                    rentedTo: `${client.name} ${client.surname}`,
                    rentedToId: client.id,
                    rentedAt: dateStr
                });
                await historyRef.add({
                    type: 'RENT',
                    gearName: gearItem.name,
                    clientName: `${client.name} ${client.surname}`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    dateStr
                });
                setModal(null);
            };

            const handleReturn = async (gearItem) => {
                const dateStr = new Date().toLocaleString('mk-MK');
                await historyRef.add({
                    type: 'RETURN',
                    gearName: gearItem.name,
                    clientName: gearItem.rentedTo,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    dateStr
                });
                await gearRef.doc(gearItem.id).update({
                    status: STATUSES.AVAILABLE,
                    rentedTo: null,
                    rentedToId: null,
                    rentedAt: null
                });
            };

            if (!user) return <div className="flex h-screen items-center justify-center font-bold">Ð¡Ðµ Ð²Ñ‡Ð¸Ñ‚ÑƒÐ²Ð°...</div>;

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 px-4">
                    <header className="py-6"><h1 className="text-4xl font-black tracking-tighter uppercase">{activeTab}</h1></header>

                    {activeTab === 'GEAR' && (
                        <div className="space-y-4">
                            <div className="flex gap-2">
                                <input placeholder="Ð‘Ð°Ñ€Ð°Ñ˜ Ð¾Ð¿Ñ€ÐµÐ¼Ð°..." className="flex-1 p-3 rounded-2xl bg-white shadow-sm" value={search} onChange={e => setSearch(e.target.value)} />
                                <button onClick={() => setModal('ADD_GEAR')} className="bg-emerald-600 text-white p-3 rounded-2xl shadow-lg">+</button>
                            </div>
                            {gear.filter(g => matchesSearch(g.name, search)).map(g => (
                                <div key={g.id} className={`p-5 rounded-[2.5rem] border ${g.status === STATUSES.RENTED ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-200'}`}>
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="text-[10px] font-bold opacity-60 uppercase">{GEAR_TYPES.find(t => t.id === g.type)?.emoji} {GEAR_TYPES.find(t => t.id === g.type)?.label}</span>
                                        <span className={`px-2 py-1 rounded-full text-[10px] font-bold ${g.status === STATUSES.AVAILABLE ? 'bg-emerald-200 text-emerald-800' : 'bg-red-200 text-red-800'}`}>{g.status}</span>
                                    </div>
                                    <h3 className="text-xl font-bold">{g.name}</h3>
                                    <p className="text-xs text-gray-500 mb-4">#{g.id.slice(-4)}</p>
                                    {g.status === STATUSES.RENTED && (
                                        <div className="mb-4 text-xs text-red-800 font-medium">
                                            <div>ðŸ•’ {g.rentedAt}</div>
                                            <div>ðŸ‘¤ {g.rentedTo}</div>
                                        </div>
                                    )}
                                    <button onClick={() => g.status === STATUSES.RENTED ? handleReturn(g) : (setSelected(g), setModal('RENT_GEAR'))} className={`w-full py-3 rounded-2xl font-black text-white ${g.status === STATUSES.RENTED ? 'bg-red-600' : 'bg-emerald-600'}`}>
                                        {g.status === STATUSES.RENTED ? 'RETURN GEAR' : 'RENT GEAR'}
                                    </button>
                                </div>
                            ))}
                        </div>
                    )}

                    {activeTab === 'CLIENTS' && (
                        <div className="space-y-4">
                            <div className="flex gap-2">
                                <input placeholder="Ð‘Ð°Ñ€Ð°Ñ˜ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¸..." className="flex-1 p-3 rounded-2xl bg-white shadow-sm" value={search} onChange={e => setSearch(e.target.value)} />
                                <button onClick={() => setModal('ADD_CLIENT')} className="bg-blue-600 text-white p-3 rounded-2xl shadow-lg">+</button>
                            </div>
                            {clients.filter(c => matchesSearch(c.name + c.surname, search)).map(c => {
                                const isRenting = gear.some(g => g.rentedToId === c.id);
                                return (
                                    <div key={c.id} className={`p-5 rounded-[2.5rem] border ${isRenting ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-200'}`}>
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-xl font-bold">{c.name} {c.surname}</h3>
                                            <span className="text-[10px] font-mono opacity-50">#{c.id.slice(-4)}</span>
                                        </div>
                                        <p className="text-sm opacity-70 mb-2">{c.phone}</p>
                                        {gear.filter(g => g.rentedToId === c.id).map(g => (
                                            <div key={g.id} className="text-[10px] text-red-800 font-bold">
                                                {g.rentedAt} {GEAR_TYPES.find(t => t.id === g.type)?.emoji} {g.name}
                                            </div>
                                        ))}
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {activeTab === 'HISTORY' && (
                        <div className="space-y-3">
                            {history.map(h => (
                                <div key={h.id} className="bg-white p-4 rounded-3xl border border-gray-100 flex items-center gap-4">
                                    <div className={`p-2 rounded-full ${h.type === 'RENT' ? 'bg-blue-50 text-blue-600' : 'bg-orange-50 text-orange-600'}`}>
                                        {h.type === 'RENT' ? 'â†“' : 'â†‘'}
                                    </div>
                                    <div>
                                        <div className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">{h.dateStr}</div>
                                        <div className="font-bold">{h.gearName}</div>
                                        <div className="text-xs text-gray-500">{h.clientName}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    <nav className="fixed bottom-6 left-4 right-4 bg-black/90 text-white p-4 rounded-[2.5rem] flex justify-around items-center backdrop-blur-md">
                        <button onClick={() => setActiveTab('GEAR')} className={activeTab === 'GEAR' ? 'text-emerald-400 font-bold' : 'opacity-50'}>GEAR</button>
                        <button onClick={() => setActiveTab('CLIENTS')} className={activeTab === 'CLIENTS' ? 'text-emerald-400 font-bold' : 'opacity-50'}>CLIENTS</button>
                        <button onClick={() => setActiveTab('HISTORY')} className={activeTab === 'HISTORY' ? 'text-emerald-400 font-bold' : 'opacity-50'}>HISTORY</button>
                    </nav>

                    {modal && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-6 z-50">
                            <div className="bg-white rounded-[2.5rem] w-full p-8 relative">
                                <button onClick={() => setModal(null)} className="absolute top-6 right-6 font-bold">X</button>
                                <h2 className="text-2xl font-black mb-6 uppercase">{modal.replace('_', ' ')}</h2>
                                
                                {modal === 'ADD_GEAR' && <AddGearForm onAdd={async (d) => { await gearRef.add({...d, status: STATUSES.AVAILABLE}); setModal(null); }} />}
                                {modal === 'ADD_CLIENT' && <AddClientForm onAdd={async (d) => { await clientsRef.add(d); setModal(null); }} />}
                                {modal === 'RENT_GEAR' && (
                                    <div className="space-y-2">
                                        {clients.map(c => (
                                            <button key={c.id} onClick={() => handleRent(selected, c)} className="w-full p-4 border rounded-2xl text-left font-bold hover:bg-emerald-50">
                                                {c.name} {c.surname}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function AddGearForm({ onAdd }) {
            const [data, setData] = React.useState({ name: '', type: 'ski' });
            return (
                <div className="space-y-4">
                    <input placeholder="Ð˜Ð¼Ðµ Ð½Ð° Ð¾Ð¿Ñ€ÐµÐ¼Ð°" className="w-full p-4 bg-gray-100 rounded-2xl" onChange={e => setData({...data, name: e.target.value})} />
                    <select className="w-full p-4 bg-gray-100 rounded-2xl" onChange={e => setData({...data, type: e.target.value})}>
                        {GEAR_TYPES.map(t => <option key={t.id} value={t.id}>{t.emoji} {t.label}</option>)}
                    </select>
                    <button onClick={() => onAdd(data)} className="w-full py-4 bg-black text-white rounded-2xl font-bold">SAVE</button>
                </div>
            );
        }

        function AddClientForm({ onAdd }) {
            const [data, setData] = React.useState({ name: '', surname: '', phone: '' });
            return (
                <div className="space-y-4">
                    <input placeholder="Ð˜Ð¼Ðµ" className="w-full p-4 bg-gray-100 rounded-2xl" onChange={e => setData({...data, name: e.target.value})} />
                    <input placeholder="ÐŸÑ€ÐµÐ·Ð¸Ð¼Ðµ" className="w-full p-4 bg-gray-100 rounded-2xl" onChange={e => setData({...data, surname: e.target.value})} />
                    <input placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½" className="w-full p-4 bg-gray-100 rounded-2xl" onChange={e => setData({...data, phone: e.target.value})} />
                    <button onClick={() => onAdd(data)} className="w-full py-4 bg-black text-white rounded-2xl font-bold">SAVE</button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
